<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Manuel Montenegro Montes">
  <title>Comportamientos OTP: cliente/servidor</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="dist/reset.css">
  <link rel="stylesheet" href="dist/reveal.css">
  <link rel="stylesheet" href="css/nnfx-light.min.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #204a87; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #204a87; font-weight: bold; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="css/pdap.css" id="theme">
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="img/RedBackground.jpg">
  <h1 class="title">Comportamientos OTP: cliente/servidor</h1>
<div id="author-container">
<div class="author">
Manuel Montenegro Montes
<br>
<span id="email"><a href="montenegro@fdi.ucm.es">montenegro@fdi.ucm.es</a></span>
</div>
<div class="subject">
<strong>Programación Declarativa Aplicada</strong>
<br>Máster en Ingeniería Informática<br>Facultad de
Informática<br>Universidad Complutense de Madrid
</div>
</div>
</section>

<section id="section" class="slide level2 outline"
data-background-image="img/RedBackground.jpg">
<h2 class="outline" data-background-image="img/RedBackground.jpg"></h2>
<ol type="1">
<li>Repaso de implementación de servidores</li>
<li>Abstracción de implementaciones</li>
<li>La plataforma OTP</li>
<li>El comportamiento <span
style="font-family: monospace;text-transform: none;">GenServer</span></li>
</ol>
</section>
<section>
<section id="repaso-de-implementación-de-servidores"
class="title-slide slide level1">
<h1>Repaso de implementación de servidores</h1>

</section>
<section id="servidor-de-áreas" class="slide level2">
<h2>Servidor de áreas</h2>
<p><svg
   width="207.83116mm"
   height="56.131001mm"
   viewBox="0 0 207.83117 56.131"
   version="1.1"
   id="svg1"
   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"
   sodipodi:docname="Area1.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     inkscape:zoom="1.0167041"
     inkscape:cx="328.51249"
     inkscape:cy="75.243131"
     inkscape:window-width="1920"
     inkscape:window-height="1011"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="layer1" />
  <defs
     id="defs1">
    <marker
       style="overflow:visible"
       id="marker9"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Wide arrow"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         style="fill:none;stroke:context-stroke;stroke-width:1;stroke-linecap:butt"
         d="M 3,-3 0,0 3,3"
         transform="rotate(180,0.125,0)"
         sodipodi:nodetypes="ccc"
         id="path9" />
    </marker>
    <marker
       style="overflow:visible"
       id="ArrowWide"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Wide arrow"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         style="fill:none;stroke:context-stroke;stroke-width:1;stroke-linecap:butt"
         d="M 3,-3 0,0 3,3"
         transform="rotate(180,0.125,0)"
         sodipodi:nodetypes="ccc"
         id="path1" />
    </marker>
  </defs>
  <g
     inkscape:label="Capa 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-27.523301,-10.474738)">
    <g
       id="g3"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1"
         width="35.8829"
         height="11.960966"
         x="27.60223"
         y="22.10714" />
      <text
         xml:space="preserve"
         style="font-size:6.35px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="45.635685"
         y="30.178438"
         id="text1"><tspan
           sodipodi:role="line"
           id="tspan1"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:6.35px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="45.635685"
           y="30.178438">Cliente</tspan></text>
    </g>
    <g
       id="g4"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1-5"
         width="35.8829"
         height="11.960966"
         x="121.84221"
         y="22.10714" />
      <text
         xml:space="preserve"
         style="font-size:6.35px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="140.78551"
         y="30.122612"
         id="text1-9"><tspan
           sodipodi:role="line"
           id="tspan1-3"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:6.35px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="140.78551"
           y="30.122612">Servidor</tspan></text>
    </g>
    <text
       xml:space="preserve"
       style="font-size:6.74878px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="56.943092"
       y="56.743378"
       id="text1-6"><tspan
         sodipodi:role="line"
         id="tspan1-1"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.74878px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="56.943092"
         y="56.743378">&lt;0.162.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-size:6.74878px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="208.73215"
       y="56.46431"
       id="text1-6-0"><tspan
         sodipodi:role="line"
         id="tspan1-1-2"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.74878px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="208.73215"
         y="56.46431">&lt;0.163.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.23333px;font-family:Monospace;-inkscape-font-specification:Monospace;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.389001;stroke-opacity:1"
       x="78.390335"
       y="8.2806692"
       id="text5"><tspan
         sodipodi:role="line"
         id="tspan5"
         style="stroke-width:0.389"
         x="78.390335"
         y="8.2806692" /></text>
    <g
       id="g9"
       class="fragment"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <text
         xml:space="preserve"
         style="font-size:3.52778px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="90.874802"
         y="13.155851"
         id="text1-6-9"><tspan
           sodipodi:role="line"
           id="tspan1-1-22"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.52778px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="90.874802"
           y="13.155851">{&lt;0.162.0&gt;, <tspan
   style="fill:#004cff;fill-opacity:1;stroke-width:0.244009"
   id="tspan6">{:rectangle, 3, 4}</tspan>}</tspan></text>
      <path
         style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.24401;stroke-opacity:1;marker-end:url(#marker9)"
         d="m 63.474645,22.067676 c 34.226764,-11.960967 58.148695,0 58.148695,0"
         id="path8" />
    </g>
    <g
       id="g10"
       class="fragment"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <path
         style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.24401;stroke-opacity:1;marker-end:url(#ArrowWide)"
         d="M 121.63383,34.226764 C 92.559477,48.763941 63.85316,33.858737 63.85316,33.858737"
         id="path5" />
      <text
         xml:space="preserve"
         style="font-size:3.52778px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="92.808548"
         y="45.126816"
         id="text1-6-9-3"><tspan
           sodipodi:role="line"
           id="tspan1-1-22-6"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.52778px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="92.808548"
           y="45.126816">{&lt;0.163.0&gt;, <tspan
   style="fill:#069b00;fill-opacity:1;stroke-width:0.244009"
   id="tspan7">12</tspan>}</tspan></text>
    </g>
  </g>
</svg>
</p>
<div class="fragment">
<p><svg
   width="207.83116mm"
   height="56.131001mm"
   viewBox="0 0 207.83117 56.131"
   version="1.1"
   id="svg1"
   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"
   sodipodi:docname="Area2.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     inkscape:zoom="1.0167041"
     inkscape:cx="336.87285"
     inkscape:cy="118.52023"
     inkscape:window-width="1920"
     inkscape:window-height="1011"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="layer1" />
  <defs
     id="defs1">
    <marker
       style="overflow:visible"
       id="marker9"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Wide arrow"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         style="fill:none;stroke:context-stroke;stroke-width:1;stroke-linecap:butt"
         d="M 3,-3 0,0 3,3"
         transform="rotate(180,0.125,0)"
         sodipodi:nodetypes="ccc"
         id="path9" />
    </marker>
    <marker
       style="overflow:visible"
       id="ArrowWide"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Wide arrow"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         style="fill:none;stroke:context-stroke;stroke-width:1;stroke-linecap:butt"
         d="M 3,-3 0,0 3,3"
         transform="rotate(180,0.125,0)"
         sodipodi:nodetypes="ccc"
         id="path1" />
    </marker>
  </defs>
  <g
     inkscape:label="Capa 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-27.523301,-10.474738)">
    <g
       id="g3"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1"
         width="35.8829"
         height="11.960966"
         x="27.60223"
         y="22.10714" />
      <text
         xml:space="preserve"
         style="font-size:6.35px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="45.635685"
         y="30.178438"
         id="text1"><tspan
           sodipodi:role="line"
           id="tspan1"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:6.35px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="45.635685"
           y="30.178438">Cliente</tspan></text>
    </g>
    <g
       id="g4"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1-5"
         width="35.8829"
         height="11.960966"
         x="121.84221"
         y="22.10714" />
      <text
         xml:space="preserve"
         style="font-size:6.35px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="140.78551"
         y="30.122612"
         id="text1-9"><tspan
           sodipodi:role="line"
           id="tspan1-3"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:6.35px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="140.78551"
           y="30.122612">Servidor</tspan></text>
    </g>
    <text
       xml:space="preserve"
       style="font-size:6.74878px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="56.943092"
       y="56.743378"
       id="text1-6"><tspan
         sodipodi:role="line"
         id="tspan1-1"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.74878px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="56.943092"
         y="56.743378">&lt;0.162.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-size:6.74878px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="208.73215"
       y="56.46431"
       id="text1-6-0"><tspan
         sodipodi:role="line"
         id="tspan1-1-2"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.74878px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="208.73215"
         y="56.46431">&lt;0.163.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.23333px;font-family:Monospace;-inkscape-font-specification:Monospace;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.389001;stroke-opacity:1"
       x="78.390335"
       y="8.2806692"
       id="text5"><tspan
         sodipodi:role="line"
         id="tspan5"
         style="stroke-width:0.389"
         x="78.390335"
         y="8.2806692" /></text>
    <g
       id="g9"
       class="fragment"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <text
         xml:space="preserve"
         style="font-size:3.52778px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="90.874802"
         y="13.155851"
         id="text1-6-9"><tspan
           sodipodi:role="line"
           id="tspan1-1-22"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.52778px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="90.874802"
           y="13.155851">{&lt;0.162.0&gt;, <tspan
   style="fill:#004cff;fill-opacity:1;stroke-width:0.244009"
   id="tspan6">:otra_cosa</tspan>}</tspan></text>
      <path
         style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.24401;stroke-opacity:1;marker-end:url(#marker9)"
         d="m 63.474645,22.067676 c 34.226764,-11.960967 58.148695,0 58.148695,0"
         id="path8" />
    </g>
    <g
       id="g10"
       class="fragment"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <path
         style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.24401;stroke-opacity:1;marker-end:url(#ArrowWide)"
         d="M 121.63383,34.226764 C 92.559477,48.763941 63.85316,33.858737 63.85316,33.858737"
         id="path5" />
      <text
         xml:space="preserve"
         style="font-size:3.52778px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="92.808548"
         y="45.126816"
         id="text1-6-9-3"><tspan
           sodipodi:role="line"
           id="tspan1-1-22-6"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.52778px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="92.808548"
           y="45.126816">{&lt;0.163.0&gt;, <tspan
   style="fill:#9b0f00;fill-opacity:1;stroke-width:0.244009"
   id="tspan7">{:error, :otra_cosa}</tspan>}</tspan></text>
    </g>
  </g>
</svg>
</p>
</div>
</section>
<section class="slide level2">

<h3 id="implementación-del-servidor">Implementación del servidor</h3>
<div class="sourceCode" id="cb1" style="font-size:95%"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">AreaServer</span> <span class="kw">do</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> loop<span class="fu">()</span> <span class="kw">do</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span>from, <span class="fu">{</span><span class="va">:rectangle</span>, width, height<span class="fu">}}</span> <span class="op">-&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, width <span class="op">*</span> height<span class="fu">})</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        loop<span class="fu">()</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span>from, <span class="fu">{</span><span class="va">:circle</span>, radius<span class="fu">}}</span> <span class="op">-&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, <span class="va">:math</span><span class="op">.</span>pi<span class="fu">()</span> <span class="op">*</span> radius <span class="op">*</span> radius<span class="fu">})</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        loop<span class="fu">()</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span>from, other<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, <span class="fu">{</span><span class="va">:error</span>, other<span class="fu">}})</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        loop<span class="fu">()</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> start<span class="fu">()</span>, <span class="va">do:</span> spawn_link<span class="fu">(</span><span class="cn">AreaServer</span>, <span class="va">:loop</span>, <span class="ot">[]</span><span class="fu">)</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

</section>
<section class="slide level2">

<h3 id="uso-del-servidor">Uso del servidor</h3>
<pre class="text"><code>&gt; p = AreaServer.start()
#PID&lt;0.163.0&gt;

&gt; send(p, {self(), {:circle, 4}})
{#PID&lt;0.162.0&gt;, {:circle, 4}}

&gt; flush()
{#PID&lt;0.163.0&gt;, 50.26548245743669}</code></pre>

</section>
<section class="slide level2">

<ul>
<li>Introducimos una interfaz del servidor para que el cliente no tenga
que enviar y recibir mensajes directamente:</li>
</ul>
<div class="sourceCode" id="cb3"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> area_rectangle<span class="fu">(</span>pid_server, width, height<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  send<span class="fu">(</span>pid_server, <span class="fu">{</span>self<span class="fu">()</span>, <span class="fu">{</span><span class="va">:rectangle</span>, width, height<span class="fu">}})</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="op">^</span>pid_server, response<span class="fu">}</span> <span class="op">-&gt;</span> response</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> area_circle<span class="fu">(</span>pid_server, radius<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  send<span class="fu">(</span>pid_server, <span class="fu">{</span>self<span class="fu">()</span>, <span class="fu">{</span><span class="va">:circle</span>, radius<span class="fu">}})</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="op">^</span>pid_server, response<span class="fu">}</span> <span class="op">-&gt;</span> response</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

<pre class="text"><code>&gt; p = AreaServer.start()
&gt; AreaServer.area_rectangle(p, 10, 2)
20</code></pre>

</section>
<section class="slide level2">

<div>
<ul>
<li class="fragment"><p>Introducimos una función <code>call/2</code>
para evitar repetición de código.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defp</span> call<span class="fu">(</span>pid_server, request<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  send<span class="fu">(</span>pid_server, <span class="fu">{</span>self<span class="fu">()</span>, request<span class="fu">})</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="op">^</span>pid_server, response<span class="fu">}</span> <span class="op">-&gt;</span> response</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
<li class="fragment"><p>De este modo, la implementación de
<code>area_rectangle/3</code> y <code>area_circle/2</code> queda del
siguiente modo:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> area_rectangle<span class="fu">(</span>pid_server, width, height<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  call<span class="fu">(</span>pid_server, <span class="fu">{</span><span class="va">:rectangle</span>, width, height<span class="fu">})</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> area_circle<span class="fu">(</span>pid_server, radius<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  call<span class="fu">(</span>pid_server, <span class="fu">{</span><span class="va">:circle</span>, radius<span class="fu">})</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
</ul>
</div>
</section>
<section id="servidor-de-ficheros" class="slide level2">
<h2>Servidor de ficheros</h2>
<p><svg
   width="222.40439mm"
   height="55.502071mm"
   viewBox="0 0 222.4044 55.502071"
   version="1.1"
   id="svg1"
   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"
   sodipodi:docname="FileServer1.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     inkscape:zoom="1.0167041"
     inkscape:cx="336.87285"
     inkscape:cy="116.55309"
     inkscape:window-width="1920"
     inkscape:window-height="1011"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="g10" />
  <defs
     id="defs1">
    <marker
       style="overflow:visible"
       id="Triangle"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Triangle arrow"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         transform="scale(0.5)"
         style="fill:context-stroke;fill-rule:evenodd;stroke:context-stroke;stroke-width:1pt"
         d="M 5.77,0 -2.88,5 V -5 Z"
         id="path135" />
    </marker>
  </defs>
  <g
     inkscape:label="Capa 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-27.523301,-10.99542)">
    <g
       id="g3"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1"
         width="35.8829"
         height="11.960966"
         x="27.60223"
         y="22.10714" />
      <text
         xml:space="preserve"
         style="font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="44.819489"
         y="29.362242"
         id="text1"><tspan
           sodipodi:role="line"
           id="tspan1"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="44.819489"
           y="29.362242">Cliente</tspan></text>
    </g>
    <g
       id="g4"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-8.8699445)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1-5"
         width="45.0243"
         height="15.04926"
         x="121.84221"
         y="22.107138" />
      <text
         xml:space="preserve"
         style="font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="144.37677"
         y="28.16374"
         id="text1-9"><tspan
           sodipodi:role="line"
           id="tspan1-3"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="144.37677"
           y="28.16374">Servidor</tspan></text>
      <text
         xml:space="preserve"
         style="font-size:3.09803px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#0039a3;fill-opacity:1;stroke:none;stroke-width:0.24401"
         x="144.52353"
         y="34.74173"
         id="text1-9-7"><tspan
           sodipodi:role="line"
           id="tspan1-3-8"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.09803px;font-family:monospace;-inkscape-font-specification:monospace;fill:#0039a3;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="144.52353"
           y="34.74173">dir = &quot;/home/manuel&quot;</tspan></text>
    </g>
    <text
       xml:space="preserve"
       style="font-size:4.93889px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="56.162384"
       y="55.181961"
       id="text1-6"><tspan
         sodipodi:role="line"
         id="tspan1-1"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.93889px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="56.162384"
         y="55.181961">&lt;0.162.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-size:4.93889px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="214.45735"
       y="57.245018"
       id="text1-6-0"><tspan
         sodipodi:role="line"
         id="tspan1-1-2"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.93889px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="214.45735"
         y="57.245018">&lt;0.163.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.23333px;font-family:Monospace;-inkscape-font-specification:Monospace;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.389001;stroke-opacity:1"
       x="78.390335"
       y="8.2806692"
       id="text5"><tspan
         sodipodi:role="line"
         id="tspan5"
         style="stroke-width:0.389"
         x="78.390335"
         y="8.2806692" /></text>
    <g
       id="g9"
       class="fragment"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <text
         xml:space="preserve"
         style="font-size:3.09803px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="90.874802"
         y="13.155851"
         id="text1-6-9"><tspan
           sodipodi:role="line"
           id="tspan1-1-22"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.09803px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="90.874802"
           y="13.155851">{&lt;0.162.0&gt;, <tspan
   style="font-size:3.09803px;fill:#004cff;fill-opacity:1;stroke-width:0.244009"
   id="tspan6">:list_dir</tspan>}</tspan></text>
      <path
         style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.24400923;stroke-opacity:1;marker-end:url(#Triangle);stroke-dasharray:none"
         d="m 63.474645,22.067676 c 34.226764,-11.960967 58.148695,0 58.148695,0"
         id="path8" />
    </g>
    <g
       id="g10"
       class="fragment"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <path
         style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.24401;stroke-opacity:1;marker-end:url(#Triangle)"
         d="M 121.63383,34.226764 C 92.559477,48.763941 63.85316,33.858737 63.85316,33.858737"
         id="path5" />
      <text
         xml:space="preserve"
         style="font-size:3.09803px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="92.808548"
         y="45.126816"
         id="text1-6-9-3"><tspan
           sodipodi:role="line"
           id="tspan1-1-22-6"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.09803px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="92.808548"
           y="45.126816">{&lt;0.163.0&gt;, <tspan
   style="font-size:3.09803px;fill:#009b07;fill-opacity:1;stroke-width:0.244009"
   id="tspan7">{:ok, [&quot;Fich1.txt&quot;, ...]}</tspan>}</tspan></text>
    </g>
  </g>
</svg>
</p>
<p><svg
   width="222.40439mm"
   height="46.298988mm"
   viewBox="0 0 222.4044 46.298988"
   version="1.1"
   id="svg1"
   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"
   sodipodi:docname="FileServer2.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     inkscape:zoom="1.0167041"
     inkscape:cx="336.87285"
     inkscape:cy="116.55309"
     inkscape:window-width="1920"
     inkscape:window-height="1011"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="layer1" />
  <defs
     id="defs1">
    <marker
       style="overflow:visible"
       id="Triangle"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Triangle arrow"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         transform="scale(0.5)"
         style="fill:context-stroke;fill-rule:evenodd;stroke:context-stroke;stroke-width:1pt"
         d="M 5.77,0 -2.88,5 V -5 Z"
         id="path135" />
    </marker>
  </defs>
  <g
     inkscape:label="Capa 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-27.523301,-10.99542)">
    <g
       id="g3"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1"
         width="35.8829"
         height="11.960966"
         x="27.60223"
         y="22.10714" />
      <text
         xml:space="preserve"
         style="font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="44.819489"
         y="29.362242"
         id="text1"><tspan
           sodipodi:role="line"
           id="tspan1"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="44.819489"
           y="29.362242">Cliente</tspan></text>
    </g>
    <g
       id="g4"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-8.8699445)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1-5"
         width="45.0243"
         height="15.04926"
         x="121.84221"
         y="22.107138" />
      <text
         xml:space="preserve"
         style="font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="144.37677"
         y="28.16374"
         id="text1-9"><tspan
           sodipodi:role="line"
           id="tspan1-3"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="144.37677"
           y="28.16374">Servidor</tspan></text>
    </g>
    <text
       xml:space="preserve"
       style="font-size:4.93889px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="56.162384"
       y="55.181961"
       id="text1-6"><tspan
         sodipodi:role="line"
         id="tspan1-1"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.93889px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="56.162384"
         y="55.181961">&lt;0.162.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-size:4.93889px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="214.45735"
       y="57.245018"
       id="text1-6-0"><tspan
         sodipodi:role="line"
         id="tspan1-1-2"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.93889px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="214.45735"
         y="57.245018">&lt;0.163.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.23333px;font-family:Monospace;-inkscape-font-specification:Monospace;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.389001;stroke-opacity:1"
       x="78.390335"
       y="8.2806692"
       id="text5"><tspan
         sodipodi:role="line"
         id="tspan5"
         style="stroke-width:0.389"
         x="78.390335"
         y="8.2806692" /></text>
    <g
       id="g9"
       class="fragment"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <text
         xml:space="preserve"
         style="font-size:3.09803px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="90.874802"
         y="13.155851"
         id="text1-6-9"><tspan
           sodipodi:role="line"
           id="tspan1-1-22"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.09803px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="90.874802"
           y="13.155851">{&lt;0.162.0&gt;, <tspan
   style="font-size:3.09803px;fill:#004cff;fill-opacity:1;stroke-width:0.244009"
   id="tspan6">{:change_dir, &quot;/tmp&quot;}</tspan>}</tspan></text>
      <path
         style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.244009;stroke-dasharray:none;stroke-opacity:1;marker-end:url(#Triangle)"
         d="m 63.474645,22.067676 c 34.226764,-11.960967 58.148695,0 58.148695,0"
         id="path8" />
    </g>
    <text
       xml:space="preserve"
       style="font-size:4.93889px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#0039a3;fill-opacity:1;stroke:none;stroke-width:0.389001"
       x="213.31158"
       y="45.538605"
       id="text1-9-7"
       class="fragment"><tspan
         sodipodi:role="line"
         id="tspan1-3-8"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.93889px;font-family:monospace;-inkscape-font-specification:monospace;fill:#0039a3;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="213.31158"
         y="45.538605">dir = &quot;/tmp&quot;</tspan></text>
  </g>
</svg>
</p>
</section>
<section class="slide level2">

<h3 id="implementación">Implementación</h3>
<div class="sourceCode" id="cb7" style="font-size:90%"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loop<span class="fu">(</span>dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>from, <span class="va">:list_dir</span><span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, <span class="cn">File</span><span class="op">.</span>ls<span class="fu">(</span>dir<span class="fu">)})</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      loop<span class="fu">(</span>dir<span class="fu">)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>from, <span class="fu">{</span><span class="va">:get_file</span>, file<span class="fu">}}</span> <span class="op">-&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      path <span class="op">=</span> <span class="cn">Path</span><span class="op">.</span>join<span class="fu">(</span>dir, file<span class="fu">)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, <span class="cn">File</span><span class="op">.</span>read<span class="fu">(</span>path<span class="fu">)})</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      loop<span class="fu">(</span>dir<span class="fu">)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>_from, <span class="fu">{</span><span class="va">:change_dir</span>, new_dir<span class="fu">}}</span> <span class="op">-&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      loop<span class="fu">(</span>new_dir<span class="fu">)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> start<span class="fu">(</span>dir<span class="fu">)</span>, <span class="va">do:</span> spawn_link<span class="fu">(</span><span class="cn">FileServer</span>, <span class="va">:loop</span>, <span class="ot">[</span>dir<span class="ot">]</span><span class="fu">)</span></span></code></pre></div>

</section>
<section class="slide level2">

<ul>
<li>De nuevo, podemos introducir una interfaz funcional que abstraiga el
paso de mensajes:</li>
</ul>
<div class="sourceCode" id="cb8"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_dir<span class="fu">(</span>pid_server<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  call<span class="fu">(</span>pid_server, <span class="va">:list_dir</span><span class="fu">)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_file<span class="fu">(</span>pid_server, file<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  call<span class="fu">(</span>pid_server, <span class="fu">{</span><span class="va">:get_file</span>, file<span class="fu">})</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> change_dir<span class="fu">(</span>pid_server, new_dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  call<span class="fu">(</span>pid_server, <span class="fu">{</span><span class="va">:change_dir</span>, new_dir<span class="fu">})</span>  <span class="arrow_box_left fragment"> ⚠️ ¡Cuidado! </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

<pre class="text"><code>&gt; p = DirServer.start(&quot;/home/manuel&quot;)
&gt; DirServer.change_dir(p, &quot;/tmp&quot;)
... shell esperando ...</code></pre>

</section>
<section class="slide level2">

<ul>
<li><p>La función <code>call</code> realiza una petición al servidor, y
queda a la espera de una respuesta por parte de éste.</p></li>
<li><p>Sin embargo, cuando el servidor recibe un mensaje de la forma
<code>{:change_dir, dir}</code>, no devuelve ninguna respuesta.</p></li>
<li><p>A consecuencia de esto, la función <code>change_dir</code> (que a
su vez llama a <code>call</code>) queda a la espera de una respuesta que
nunca llegará.</p></li>
<li><p>Podemos crear una función análoga a <code>call</code> que no
espere una respuesta del servidor:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defp</span> cast<span class="fu">(</span>pid_server, request<span class="fu">)</span>, <span class="kw">do</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  send<span class="fu">(</span>pid_server, <span class="fu">{</span>self<span class="fu">()</span>, request<span class="fu">})</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">:ok</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>Cambiamos la implementación de <code>change_dir</code> del
siguiente modo:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> change_dir<span class="fu">(</span>pid_server, new_dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="hl">cast</span><span class="fu">(</span>pid_server, <span class="fu">{</span><span class="va">:change_dir</span>, new_dir<span class="fu">})</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

<pre class="text"><code>&gt; p = FileServer.start(&quot;/home/manuel&quot;)
#PID&lt;0.183.0&gt;

&gt; FileServer.list_dir(p)
{:ok, [&quot;Fich1.txt&quot;, ...]}

&gt; FileServer.change_dir(p, &quot;/tmp&quot;)

&gt; FileServer.list_dir(p)
{:ok, [&quot;tmp1.txt&quot;, &quot;tmp2.txt&quot;, ...]</code></pre>
</li>
</ul>
</section>
<section id="call-vs-cast" class="slide level2">
<h2><code>call</code> vs <code>cast</code></h2>
<div>
<ul>
<li class="fragment">Las llamadas a <code>call</code> son
<strong>síncronas</strong>:
<ul>
<li class="fragment">Cuando el cliente envía una petición, no continúa
su ejecución hasta que recibe una respuesta por parte del servidor.</li>
</ul></li>
<li class="fragment">Las llamadas a <code>cast</code> son
<strong>asíncronas</strong>:
<ul>
<li class="fragment">Tras realizar una petición, el cliente continúa su
ejecución.</li>
<li class="fragment">Más adelante, podrá recibir la respuesta del
servidor mediante <code>receive</code>, si este responde.</li>
</ul></li>
</ul>
</div>
</section>
<section id="servidor-de-tickets" class="slide level2">
<h2>Servidor de tickets</h2>
<ul>
<li><p>Como tercer y último ejemplo, implementaremos un servidor que
guarde una lista de números y los vaya distribuyendo a sus clientes a
medida que estos los pidan.</p></li>
<li><p>La función <code>loop</code> encargada de manejar el servidor
mantiene una lista de números (<em>tickets</em>).</p></li>
<li><p>Cuando esta función recibe una petición <code>get_ticket</code>
de un cliente, el servidor responde con el primer elemento de esta
lista, y vuelve a esperar al siguiente mensaje, esta vez utilizando los
<em>tickets</em> restantes.</p></li>
</ul>
</section>
<section class="slide level2">

<p><img data-src="21/Tickets1.svg" /></p>
<div class="fragment">
<p><img data-src="21/Tickets2.svg" /></p>
</div>
</section>
<section class="slide level2">

<p><img data-src="21/Tickets3.svg" /></p>
<div class="fragment">
<p><svg
   width="222.40439mm"
   height="57.169262mm"
   viewBox="0 0 222.4044 57.169262"
   version="1.1"
   id="svg1"
   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"
   sodipodi:docname="Tickets4.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     inkscape:zoom="1.0167041"
     inkscape:cx="336.87285"
     inkscape:cy="116.55309"
     inkscape:window-width="1920"
     inkscape:window-height="1011"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="layer1" />
  <defs
     id="defs1">
    <marker
       style="overflow:visible"
       id="Triangle-7"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Triangle arrow"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         transform="scale(0.5)"
         style="fill:context-stroke;fill-rule:evenodd;stroke:context-stroke;stroke-width:1pt"
         d="M 5.77,0 -2.88,5 V -5 Z"
         id="path135-4" />
    </marker>
  </defs>
  <g
     inkscape:label="Capa 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-27.523301,-10.99542)">
    <g
       id="g3"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-6.224111)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1"
         width="35.8829"
         height="11.960966"
         x="27.60223"
         y="22.10714" />
      <text
         xml:space="preserve"
         style="font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="44.819489"
         y="29.362242"
         id="text1"><tspan
           sodipodi:role="line"
           id="tspan1"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="44.819489"
           y="29.362242">Cliente</tspan></text>
    </g>
    <g
       id="g4"
       transform="matrix(1.594202,0,0,1.594202,-16.285729,-8.8699445)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1-5"
         width="45.0243"
         height="15.04926"
         x="121.84221"
         y="22.107138" />
      <text
         xml:space="preserve"
         style="font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="144.37677"
         y="28.16374"
         id="text1-9"><tspan
           sodipodi:role="line"
           id="tspan1-3"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="144.37677"
           y="28.16374">Servidor</tspan></text>
    </g>
    <text
       xml:space="preserve"
       style="font-size:4.93889px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="56.162384"
       y="55.181961"
       id="text1-6"><tspan
         sodipodi:role="line"
         id="tspan1-1"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.93889px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="56.162384"
         y="55.181961">&lt;0.162.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-size:4.93889px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="214.45735"
       y="57.245018"
       id="text1-6-0"><tspan
         sodipodi:role="line"
         id="tspan1-1-2"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.93889px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="214.45735"
         y="57.245018">&lt;0.163.0&gt;</tspan></text>
    <text
       xml:space="preserve"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.23333px;font-family:Monospace;-inkscape-font-specification:Monospace;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.389001;stroke-opacity:1"
       x="78.390335"
       y="8.2806692"
       id="text5"><tspan
         sodipodi:role="line"
         id="tspan5"
         style="stroke-width:0.389"
         x="78.390335"
         y="8.2806692" /></text>
    <text
       xml:space="preserve"
       style="font-size:4.93889px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#0039a3;fill-opacity:1;stroke:none;stroke-width:0.389001"
       x="213.31158"
       y="45.538605"
       id="text1-9-7"><tspan
         sodipodi:role="line"
         id="tspan1-3-8"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.93889px;font-family:monospace;-inkscape-font-specification:monospace;fill:#0039a3;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="213.31158"
         y="45.538605">tickets = [3]</tspan></text>
    <path
       style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.389001;stroke-opacity:1;marker-end:url(#Triangle-7)"
       d="M 177.55566,50.007458 C 131.20527,73.18265 85.441605,49.420748 85.441605,49.420748"
       id="path5" />
    <text
       xml:space="preserve"
       style="font-size:4.93889px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.389001"
       x="131.60234"
       y="67.384338"
       id="text1-6-9-3"><tspan
         sodipodi:role="line"
         id="tspan1-1-22-6"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4.93889px;font-family:Monospace;-inkscape-font-specification:Monospace;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.389"
         x="131.60234"
         y="67.384338">{&lt;0.163.0&gt;, <tspan
   style="font-size:4.93889px;fill:#009b07;fill-opacity:1;stroke-width:0.389"
   id="tspan7">3</tspan>}</tspan></text>
    <g
       id="g10"
       class="fragment">
      <path
         style="fill:#009b07;fill-opacity:1;stroke:#bc0000;stroke-width:4.4890001;stroke-dasharray:none;stroke-opacity:1"
         d="M 184.96628,62.522211 243.25921,14.898965"
         id="path10" />
      <path
         style="fill:#009b07;fill-opacity:1;stroke:#bc0000;stroke-width:4.489;stroke-dasharray:none;stroke-opacity:1"
         d="m 186.5014,16.535738 54.90986,43.459469"
         id="path10-3"
         sodipodi:nodetypes="cc" />
    </g>
  </g>
</svg>
</p>
</div>
</section>
<section class="slide level2">

<h3 id="implementación-1">Implementación</h3>
<div class="sourceCode" id="cb13" style="font-size:90%"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loop<span class="fu">(</span>tickets<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>from, <span class="va">:get_ticket</span><span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">case</span> tickets <span class="kw">do</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="ot">[]</span> <span class="op">-&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>          send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, <span class="va">:error</span><span class="fu">})</span>  <span class="arrow_box_left fragment"> El servidor termina tras responder </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="ot">[</span>t<span class="ot">]</span> <span class="op">-&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>          send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, t<span class="fu">})</span>       <span class="arrow_box_left fragment"> El servidor termina tras responder </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="ot">[</span>t<span class="op">|</span>ts<span class="ot">]</span> <span class="op">-&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>          send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, t<span class="fu">})</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>          loop<span class="fu">(</span>ts<span class="fu">)</span>                      <span class="arrow_box_left fragment"> El servidor continúa su ejecución </span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">end</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> start<span class="fu">(</span>num_tickets<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  spawn_link<span class="fu">(</span><span class="cn">TicketServer</span>, <span class="va">:loop</span>, <span class="ot">[</span><span class="cn">Enum</span><span class="op">.</span>into<span class="fu">(</span><span class="dv">1</span><span class="op">..</span>num_tickets, <span class="ot">[]</span><span class="fu">)</span><span class="ot">]</span><span class="fu">)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

</section>
<section class="slide level2">

<h3 id="ejemplo-de-ejecución">Ejemplo de ejecución</h3>
<pre class="text"><code>&gt; p = TicketServer.start(4)
#PID&lt;0.146.0&gt;

&gt; TicketServer.get_ticket(p)
1

&gt; TicketServer.get_ticket(p)
2

&gt; TicketServer.get_ticket(p)
3

&gt; TicketServer.get_ticket(p)
4

&gt; Process.alive?(p)
false    <span class="arrow_box_left fragment"> El proceso muere tras emitir el último ticket </span></code></pre>

</section></section>
<section>
<section id="abstracción-de-implementaciones"
class="title-slide slide level1">
<h1>Abstracción de implementaciones</h1>

</section>
<section id="abstracción-de-implementaciones-1" class="slide level2">
<h2>Abstracción de implementaciones</h2>
<ul>
<li><p>Comparemos las implementaciones de los tres servidores:</p>
<ul>
<li><code>AreaServer</code></li>
<li><code>FileServer</code></li>
<li><code>TicketServer</code></li>
</ul></li>
</ul>
<div class="info_box fragment">
<p>🤔 ¿Qué tienen en común?</p>
</div>
<div class="info_box fragment" style="margin-top:1em">
<p>🤔 ¿En qué difieren?</p>
</div>
</section>
<section id="estado-del-servidor" class="slide level2">
<h2>Estado del servidor</h2>
<ul>
<li><p>Las tres implementaciones disponen de una función
<code>loop</code> recursiva que procesa los mensajes recibidos.</p></li>
<li><p>Las funciones <code>loop</code> pueden recibir un parámetro que
contiene la información de <em>estado</em> del servidor.</p>
<ul>
<li>Se propaga y/o modifica desde una llamada recursiva a la
siguiente.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb15" style="font-size:90%"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loop<span class="fu">(</span>state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>from, <span class="meta">tipo_mensaje_1</span><span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>      <span class="meta"><span class="op">...</span>responder a `from`<span class="op">...</span></span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>      new_state <span class="op">=</span> <span class="meta"><span class="op">...</span>siguiente_estado<span class="op">...</span></span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      loop<span class="fu">(</span>new_state<span class="fu">)</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>from, <span class="meta">tipo_mensaje_2</span><span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

</section>
<section class="slide level2">

<div
style="display:grid; grid-template-columns:1fr 1fr; justify-items:start">
<div class="fragment">
<ul>
<li><p><strong>Servidor de ficheros</strong></p>
<p>Directorio actual</p></li>
</ul>
</div>
<div class="fragment" style="justify-self:center">
<p><img data-src="21/State1.svg" /></p>
</div>
<div class="fragment">
<ul>
<li><p><strong>Servidor de tickets</strong></p>
<p>Lista de tickets restantes</p></li>
</ul>
</div>
<div class="fragment" style="justify-self:center">
<p><img data-src="21/State2.svg" /></p>
</div>
<div class="fragment">
<ul>
<li><p><strong>Servidor de áreas</strong></p>
<p>No hay estado</p>
<p><span style="font-size:80%"><em>Podemos utilizar una constante como
estado (por ejemplo, <code>:ok</code>)</em></span></p></li>
</ul>
</div>
<div class="fragment" style="justify-self:center">
<p><svg
   width="72.166832mm"
   height="24.380562mm"
   viewBox="0 0 72.166832 24.380562"
   version="1.1"
   id="svg1"
   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"
   sodipodi:docname="State3.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview1"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     inkscape:zoom="0.71891835"
     inkscape:cx="312.27468"
     inkscape:cy="451.37254"
     inkscape:window-width="1920"
     inkscape:window-height="1011"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="g4" />
  <defs
     id="defs1" />
  <g
     inkscape:label="Capa 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-22.497392,-29.139891)">
    <g
       id="g4"
       transform="matrix(1.594202,0,0,1.594202,-171.5492,-5.9088519)"
       style="stroke-width:0.627273">
      <rect
         style="fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         id="rect1-5"
         width="45.0243"
         height="15.04926"
         x="121.84221"
         y="22.107138" />
      <text
         xml:space="preserve"
         style="font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#b4e8ff;fill-opacity:1;stroke:#000000;stroke-width:0.24401"
         x="144.37677"
         y="28.16374"
         id="text1-9"><tspan
           sodipodi:role="line"
           id="tspan1-3"
           style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.98318px;font-family:Raleway;-inkscape-font-specification:'Raleway Bold';fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="144.37677"
           y="28.16374">Servidor</tspan></text>
      <text
         xml:space="preserve"
         style="font-size:3.09803px;font-family:Raleway;-inkscape-font-specification:Raleway;text-align:center;writing-mode:lr-tb;direction:ltr;text-anchor:middle;fill:#0039a3;fill-opacity:1;stroke:none;stroke-width:0.24401"
         x="144.52353"
         y="34.74173"
         id="text1-9-7"
         class="fragment"><tspan
           sodipodi:role="line"
           id="tspan1-3-8"
           style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.09803px;font-family:monospace;-inkscape-font-specification:monospace;fill:#0039a3;fill-opacity:1;stroke:none;stroke-width:0.244009"
           x="144.52353"
           y="34.74173">state = :ok</tspan></text>
    </g>
  </g>
</svg>
</p>
</div>
</div>
</section>
<section id="tratamiento-de-mensajes" class="slide level2">
<h2>Tratamiento de mensajes</h2>
<div style="font-size:80%">
<ul>
<li>Cada servidor trata un tipo de mensaje de manera específica:
<ul>
<li>Determina la respuesta que será devuelta al cliente.</li>
<li>Determina el siguiente estado.</li>
</ul></li>
<li>Separamos el tratamiento de mensajes en una función
<code>handle_call</code>, que recibe tres parámetros:
<ul>
<li>El mensaje recibido (<code>request</code>)</li>
<li>El remitente del mensaje (<code>from</code>)</li>
<li>El estado actual (<code>state</code>)</li>
</ul></li>
<li>Esta función devolverá:
<ul>
<li>La respuesta que será devuelta al cliente
(<code>response</code>)</li>
<li>El siguiente estado (<code>new_state</code>)</li>
</ul></li>
</ul>
</div>
</section>
<section class="slide level2">

<ul>
<li><p>La función <code>handle_call</code> devolverá una tupla de la
forma <code>{:reply, response, new_state}</code>.</p></li>
<li><p>El bucle de recepción de mensajes queda del siguiente modo:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loop<span class="fu">(</span>state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>from, request<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span><span class="va">:reply</span>, response, new_state<span class="fu">}</span> <span class="op">=</span> <span class="hl">handle_call<span class="fu">(</span>request, from, state<span class="fu">)</span></span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, response<span class="fu">})</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      loop<span class="fu">(</span>new_state<span class="fu">)</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
</ul>
</section>
<section class="slide level2">

<h3 id="servidor-de-áreas-handle_call">Servidor de áreas:
<code>handle_call</code></h3>
<div class="sourceCode" id="cb17"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:rectangle</span>, width, height<span class="fu">}</span>, _from, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, width <span class="op">*</span> height, state<span class="fu">}</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:circle</span>, radius<span class="fu">}</span>, _from, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="va">:math</span><span class="op">.</span>pi <span class="op">*</span> radius <span class="op">*</span> radius, state<span class="fu">}</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span>other, _from, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="fu">{</span><span class="va">:error</span>, other<span class="fu">}</span>, state<span class="fu">}</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

</section>
<section class="slide level2">

<h3 id="servidor-de-ficheros-handle_call">Servidor de ficheros:
<code>handle_call</code></h3>
<div class="sourceCode" id="cb18"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:list_dir</span>, _from, dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="cn">File</span><span class="op">.</span>ls<span class="fu">(</span>dir<span class="fu">)</span>, dir<span class="fu">}</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:get_file</span>, file<span class="fu">}</span>, _from, dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  path <span class="op">=</span> <span class="cn">Path</span><span class="op">.</span>join<span class="fu">(</span>dir, file<span class="fu">)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="cn">File</span><span class="op">.</span>read<span class="fu">(</span>path<span class="fu">)</span>, dir<span class="fu">}</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:change_dir</span>, new_dir<span class="fu">}</span>, _from, _dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="va">:ok</span>, <span class="hl">new_dir</span><span class="fu">}</span>  <span class="arrow_box_left"> Devolvemos `:ok` y cambiamos estado </span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

<ul>
<li>Esta versión del servidor de ficheros se comporta de manera distinta
a la versión inicial, ¿en qué se diferencian?</li>
</ul>
</section>
<section class="slide level2">

<h3 id="servidor-de-tickets-handle_call">Servidor de tickets:
<code>handle_call</code></h3>
<div class="sourceCode" id="cb19"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:get_ticket</span>, _from, <span class="ot">[]</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="va">:error</span>, <span class="ot">[]</span><span class="fu">}</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:get_ticket</span>, _from, <span class="ot">[</span>t<span class="ot">]</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, t, <span class="ot">[]</span><span class="fu">}</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:get_ticket</span>, _from, <span class="ot">[</span>t <span class="op">|</span> ts<span class="ot">]</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, t, ts<span class="fu">}</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

<ul>
<li>Esta versión del servidor de tickets se comporta de manera distinta
a la versión inicial, ¿en qué se diferencian?</li>
</ul>
</section>
<section id="parada-del-servidor" class="slide level2">
<h2>Parada del servidor</h2>
<ul>
<li><p>En el servidor de tickets original, el servidor se detenía tras
expedir el último ticket.</p></li>
<li><p>En la versión transformada, esto ya no es así.</p></li>
<li><p>Para poder determinar cuándo parar el servidor, distinguiremos
entre dos tipos de respuestas en <code>handle_call</code>:</p>
<ul>
<li><p><code>{:reply, response, new_state}</code></p>
<p>El servidor devolverà <code>response</code> al cliente, y el nuevo
estado será <code>new_state</code>.</p></li>
<li><p><code>{:stop, response}</code></p>
<p>El servidor devolverá <code>response</code> al cliente y
finalizará.</p></li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>La función <code>loop</code> que gestiona los mensajes queda del
siguiente modo:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loop<span class="fu">(</span>state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>from, request<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">case</span> handle_call<span class="fu">(</span>request, from, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="va">:reply</span>, response, new_state<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>          send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, response<span class="fu">})</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>          loop<span class="fu">(</span>new_state<span class="fu">)</span>               <span class="arrow_box_left"> El servidor continúa su ejecución </span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="va">:stop</span>, response<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>          send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, response<span class="fu">})</span> <span class="arrow_box_left"> El servidor finaliza </span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">end</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>Modificamos la función <code>handle_call</code> del servidor de
tickets:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:get_ticket</span>, _from, <span class="ot">[]</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="hl"><span class="va">:stop</span></span>, <span class="va">:error</span><span class="fu">}</span>     <span class="arrow_box_left"> El servidor finaliza </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:get_ticket</span>, _from, <span class="ot">[</span>t<span class="ot">]</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="hl"><span class="va">:stop</span></span>, t<span class="fu">}</span>          <span class="arrow_box_left"> El servidor finaliza </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:get_ticket</span>, _from, <span class="ot">[</span>t <span class="op">|</span> ts<span class="ot">]</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="hl"><span class="va">:reply</span></span>, t, ts<span class="fu">}</span>     <span class="arrow_box_left"> El servidor continúa </span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
</ul>
</section>
<section id="llamadas-síncronas-y-asíncronas" class="slide level2">
<h2>Llamadas síncronas y asíncronas</h2>
<div style="font-size:80%">
<ul>
<li><p>La implementación genérica de <code>loop</code> que hemos
desarrollado solamente permite llamadas síncronas.</p>
<ul>
<li>Es decir, cada vez que el cliente realiza una llamada al servidor,
espera a que el servidor le responda (aunque sea con
<code>:ok</code>).</li>
</ul></li>
<li><p>Esto ocurría en el servidor de ficheros, donde la petición
<code>{:change_dir, new_dir}</code> no exige una respuesta del
servidor.</p></li>
<li><p>Podemos separar el código de tratamiento de mensajes en dos
funciones:</p>
<ul>
<li><code>handle_call</code>: Llamadas síncronas, que esperan
respuesta.</li>
<li><code>handle_cast</code>: Llamadas asíncronas, que no esperan
respuesta.</li>
</ul></li>
</ul>
</div>
</section>
<section class="slide level2">

<h3 id="tratamiento-de-llamadas-asíncronas">Tratamiento de llamadas
asíncronas</h3>
<ul>
<li>La función <code>handle_cast</code> recibe dos parámetros:
<ul>
<li>Petición (<code>request</code>)</li>
<li>Estado actual (<code>state</code>)</li>
</ul></li>
<li>Puede devolver dos tipos de resultados:
<ul>
<li><p><code>{:noreply, new_state}</code></p>
<p>El servidor continuará su ejecución con <code>new_state</code> como
nueva información de estado.</p></li>
<li><p><code>:stop</code></p>
<p>El servidor se detendrá.</p></li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>El servidor de ficheros queda del siguiente modo:</p>
<ul>
<li><p><code>handle_call</code> para llamadas síncronas</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:list_dir</span>, _from, dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="cn">File</span><span class="op">.</span>ls<span class="fu">(</span>dir<span class="fu">)</span>, dir<span class="fu">}</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:get_file</span>, file<span class="fu">}</span>, _from, dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  path <span class="op">=</span> <span class="cn">Path</span><span class="op">.</span>join<span class="fu">(</span>dir, file<span class="fu">)</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="cn">File</span><span class="op">.</span>read<span class="fu">(</span>path<span class="fu">)</span>, dir<span class="fu">}</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
<li><p><code>handle_cast</code> para llamadas asíncronas</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_cast<span class="fu">({</span><span class="va">:change_dir</span>, new_dir<span class="fu">}</span>, _dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:noreply</span>, new_dir<span class="fu">}</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>Actualizamos la función <code>loop</code> genérica para tratar
los mensajes recibidos por el servidor. Distinguiremos dos tipos de
mensajes:</p>
<ul>
<li><code>{from, :call, request}</code>: llamadas síncronas</li>
<li><code>{from, :cast, request}</code>: llamadas asíncronas</li>
</ul>
<div class="sourceCode" id="cb24"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loop<span class="fu">(</span>state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>from, <span class="hl"><span class="va">:call</span></span>, request<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>_from, <span class="hl"><span class="va">:cast</span></span>, request<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
</ul>
</section>
<section class="slide level2">

<h3 id="gestión-de-llamadas-síncronas">Gestión de llamadas
síncronas</h3>
<p>Ningún cambio con respecto a la versión anterior, salvo la componente
<code>:call</code> en la tupla del mensaje.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> loop<span class="fu">(</span>state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span>from, <span class="hl"><span class="va">:call</span></span>, request<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">case</span> handle_call<span class="fu">(</span>request, from, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span><span class="va">:reply</span>, response, new_state<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, response<span class="fu">})</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>            loop<span class="fu">(</span>new_state<span class="fu">)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">{</span><span class="va">:stop</span>, response<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>            send<span class="fu">(</span>from, <span class="fu">{</span>self<span class="fu">()</span>, response<span class="fu">})</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>

</section>
<section class="slide level2">

<h3 id="gestión-de-llamadas-asíncronas">Gestión de llamadas
asíncronas</h3>
<div class="sourceCode" id="cb26"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loop<span class="fu">(</span>state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span>_from, <span class="hl"><span class="va">:cast</span></span>, request<span class="fu">}</span> <span class="op">-&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">case</span> <span class="hl">handle_cast<span class="fu">(</span>request, state<span class="fu">)</span></span> <span class="kw">do</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="va">:noreply</span>, new_state<span class="fu">}</span> <span class="op">-&gt;</span> loop<span class="fu">(</span>new_state<span class="fu">)</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">:stop</span> <span class="op">-&gt;</span> <span class="va">:ok</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">end</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

</section>
<section class="slide level2">

<h3 id="funciones-call2-y-cast2">Funciones <code>call/2</code> y
<code>cast/2</code></h3>
<ul>
<li>Igual que las versiones anteriores, pero incluimos las componentes
<code>:call</code> y <code>:cast</code> en las tuplas del mensaje, según
el caso.</li>
</ul>
<div class="sourceCode" id="cb27"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defp</span> call<span class="fu">(</span>pid_server, request<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  send<span class="fu">(</span>pid_server, <span class="fu">{</span>self<span class="fu">()</span>, <span class="hl"><span class="va">:call</span></span>, request<span class="fu">})</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">receive</span> <span class="kw">do</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="op">^</span>pid_server, response<span class="fu">}</span> <span class="op">-&gt;</span> response</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="kw">defp</span> cast<span class="fu">(</span>pid_server, request<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  send<span class="fu">(</span>pid_server, <span class="fu">{</span>self<span class="fu">()</span>, <span class="hl"><span class="va">:cast</span></span>, request<span class="fu">})</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">:ok</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

</section>
<section id="resumen" class="slide level2">
<h2>Resumen</h2>
<ul>
<li><p>Hemos identificado los componentes genéricos comunes a las
implementaciones de un servidor.</p>
<ul>
<li>Función <code>loop</code> genérica</li>
<li>Funciones <code>call</code> y <code>cast</code> genéricas</li>
</ul></li>
<li><p>Hemos identificado los componentes específicos de cada
ejemplo:</p>
<ul>
<li>Definición de la función <code>handle_call</code></li>
<li>Definición de la función <code>handle_cast</code></li>
<li>Funciones de interfaz (esto es, las que hacen uso de
<code>call</code> y <code>cast</code>)</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="ventajas">Ventajas</h3>
<ul style="list-style:none;padding:0;margin:0">
<li class="hands_up fragment">
<strong>Reutilización de código</strong>: Los componentes genéricos
pueden formar parte de una biblioteca.
</li>
<li class="hands_up fragment">
<strong>Separación entre código concurrente y secuencial</strong>: las
funciones <code>handle_call</code> y <code>handle_cast</code> utilizan
exclusivamente Elixir secuencial. El paso de mensajes queda encapsulado
en las funciones <code>call</code>, <code>cast</code> y
<code>loop</code>.
</li>
<li class="hands_up fragment">
<strong>Interfaz unificada</strong> para todos los servidores.
</li>
</ul>
</section>
<section id="extensiones" class="slide level2">
<h2>Extensiones</h2>
<ul>
<li><p>Nuestra implementación genérica de servidores puede extenderse
aún más:</p>
<ul>
<li><p>Tratamiento de excepciones</p></li>
<li><p>Recepción de señales <code>:EXIT</code> procedentes de enlaces
vitales</p></li>
<li><p>Inicialización, finalización y liberación de recursos</p></li>
<li><p><em>Hot-code swapping</em></p></li>
</ul></li>
</ul>
<div class="info_box fragment">
<p>😎 Pero las bibliotecas de Elixir ya se encargan de esto, como
veremos a continuación.</p>
</div>
</section></section>
<section>
<section id="la-plataforma-otp" class="title-slide slide level1">
<h1>La plataforma OTP</h1>

</section>
<section id="otp-open-telecom-platform" class="slide level2">
<h2>OTP (<em>Open Telecom Platform</em>)</h2>
<ul>
<li><p>OTP es una colección de bibliotecas y herramientas escritas en
Erlang, las cuales han sido «heredadas» por Elixir.</p></li>
<li><p>En estas bibliotecas podemos encontrar implementaciones de
<strong>patrones de diseño</strong> comunes a una gran cantidad de
sistemas concurrentes.</p></li>
<li><p>A la formalización de cada uno de estos patrones se le denomina
<strong>comportamiento</strong> (<em>behaviour</em>). Los
comportamientos están definidos en las bibliotecas OTP.</p></li>
</ul>
</section>
<section id="algunos-comportamientos-otp" class="slide level2">
<h2>Algunos comportamientos OTP</h2>
<dl>
<dt><code>GenServer</code></dt>
<dd>
<p>Abstrae las partes comunes en una arquitectura cliente/servidor.</p>
</dd>
<dt><code>Supervisor</code></dt>
<dd>
<p>Implementa árboles de supervisión, que permiten reiniciar procesos en
caso de que fallen.</p>
</dd>
<dt><code>GenStage</code> <em>(como biblioteca externa a OTP)</em></dt>
<dd>
<p>Permite expresar <em>pipelines</em> de eventos entre productores y
consumidores.</p>
</dd>
</dl>
</section>
<section id="otras-abstracciones-en-elixir" class="slide level2">
<h2>Otras abstracciones en Elixir</h2>
<p>Fuera de la plataforma OTP, la biblioteca estándar de Elixir
proporciona otros módulos que implementan patrones habituales en
programación concurrente:</p>
<dl>
<dt><code>Agent</code></dt>
<dd>
<p>Permite encapsular un estado dentro de un proceso.</p>
</dd>
<dt><code>Task</code></dt>
<dd>
<p>Permite modelizar tareas que se ejecutan de manera asíncrona.</p>
</dd>
</dl>
</section></section>
<section>
<section id="el-comportamiento-genserver"
class="title-slide slide level1">
<h1>El comportamiento <code>GenServer</code></h1>

</section>
<section id="el-comportamiento-genserver-1" class="slide level2">
<h2>El comportamiento <code>GenServer</code></h2>
<ul>
<li>Es el comportamiento más utilizado en las bibliotecas OTP.</li>
<li>Abstrae las partes comunes a toda implementación de una arquitectura
cliente/servidor.</li>
</ul>
<p><img data-src="21/GenServer1.svg" style="width:70.0%" /></p>
</section>
<section class="slide level2">

<p><img data-src="21/GenServer2.svg" style="width:60.0%" /></p>
<ul>
<li><p>El servidor ejecuta un bucle de recepción de mensajes mediante
una función.</p>
<ul>
<li>Para enviar y recibir los mensajes utilizamos las funciones
genéricas del cliente.</li>
<li>Para gestionar los mensajes utilizamos las funciones de la parte
específica del servidor.</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<p><img data-src="21/GenServer3.svg" style="width:60.0%" /></p>
<ul>
<li>El cliente puede hacer uso de las funciones <code>call</code> y
<code>cast</code> del módulo <code>GenServer</code>. Estas funciones
envían los mensajes correspondientes al servidor.</li>
</ul>
</section>
<section class="slide level2">

<p><img data-src="21/GenServer4.svg" style="width:60.0%" /></p>
<ul>
<li><p>El programador implementa unas funciones <em>callback</em> que
serán ejecutadas por la parte genérica del servidor:</p>
<p><code>handle_call</code>, <code>handle_cast</code>,
<code>handle_info</code>, etc.</p></li>
</ul>
</section>
<section class="slide level2">

<p><img data-src="21/GenServer5.svg" /></p>
</section>
<section id="funciones-callback-definidas-por-el-programador"
class="slide level2">
<h2>Funciones <em>callback</em> definidas por el programador</h2>
<p>Trataremos las siguientes funciones:</p>
<ul>
<li><code>init/1</code></li>
<li><code>handle_call/3</code> <em>(opcional)</em></li>
<li><code>handle_cast/2</code> <em>(opcional)</em></li>
<li><code>handle_info/2</code> <em>(opcional)</em></li>
<li><code>terminate/2</code> <em>(opcional)</em></li>
</ul>
</section>
<section id="función-callback-init1" class="slide level2">
<h2>Función <em>callback</em> <code>init/1</code></h2>
<ul>
<li><p>Debe realizar las operaciones de inicialización del servidor, y
determinar su estado inicial.</p></li>
<li><p>El parámetro que reciba <code>init/1</code> será el que se haya
especificado por el cliente al arrancar el servidor.</p></li>
<li><p>Ha de devolver alguno de los siguientes valores:</p>
<p><code>{:ok, state}</code></p>
<p><code>{:ok, state, timeout}</code></p>
<p><code>{:ok, state, :hibernate}</code></p>
<p><code>{:stop, reason}</code></p>
<p><code>:ignore</code> ###</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="posibles-valores-de-retorno-de-init1">Posibles valores de
retorno de <code>init/1</code></h3>
<ul>
<li><p><code>{:ok, state}</code></p>
<p>El servidor se inicializa correctamente y su estado inicial será
<code>state</code>.</p></li>
<li><p><code>{:ok, state, timeout}</code></p>
<p>El servidor se inicializa correctamente y su estado inicial será
<code>state</code>.</p>
<p>Si, tras la inicialización, han pasado <code>timeout</code>
milisegundos sin que haya llegado ninguna petición al servidor, este se
enviará a sí mismo un mensaje <code>:timeout</code> que serán procesado
por la función <em>callback</em> <code>handle_info</code>.</p></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p><code>{:ok, state, :hibernate}</code></p>
<p>El servidor se inicializa correctamente y su estado inicial será
<code>state</code>.</p>
<p>Tras la inicialización, el proceso servidor pasará a modo
hibernación, en el cual ocupa menos memoria. El proceso «despertará»
cuando reciba alguna petición de un cliente.</p></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p><code>{:stop, reason}</code></p>
<p>El servidor no se inicializará. El motivo de ello
(<code>reason</code>) será comunicado al cliente.</p></li>
<li><p><code>:ignore</code></p>
<p>El servidor no se inicializará. El cliente no recibe ninguna
información adicional.</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="ejemplos">Ejemplos</h3>
<h4 id="servidor-de-ficheros-1">Servidor de ficheros</h4>
<div class="sourceCode" id="cb28"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init<span class="fu">(</span>dir<span class="fu">)</span>, <span class="va">do:</span> <span class="fu">{</span><span class="va">:ok</span>, dir<span class="fu">}</span></span></code></pre></div>

<h4 id="servidor-de-tickets-1">Servidor de tickets</h4>
<div class="sourceCode" id="cb29"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init<span class="fu">(</span>num_tickets<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:ok</span>, <span class="cn">Enum</span><span class="op">.</span>into<span class="fu">(</span><span class="dv">1</span><span class="op">..</span>num_tickets, <span class="ot">[]</span><span class="fu">)}</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

<h4 id="servidor-de-áreas-1">Servidor de áreas</h4>
<div class="sourceCode" id="cb30"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init<span class="fu">(</span>num_tickets<span class="fu">)</span>, <span class="va">do:</span> <span class="fu">{</span><span class="va">:ok</span>, <span class="cn">false</span><span class="fu">}</span></span></code></pre></div>

<p>Como en el servidor de áreas no se hace uso del estado, podemos
colocar cualquier otro valor en lugar de <code>false</code>.</p>
</section>
<section id="función-callback-handle_call3" class="slide level2">
<h2>Función <em>callback</em> <code>handle_call/3</code></h2>
<ul>
<li>Se encarga de procesar los mensajes síncronos.</li>
<li>Recibe tres argumentos: <code>request</code>, <code>from</code> y
<code>state</code>.</li>
<li>Debe devolver alguno de los siguientes resultados:
<ul>
<li><code>{:reply, reply, new_state}</code></li>
<li><code>{:reply, reply, new_state, timeout}</code></li>
<li><code>{:reply, reply, new_state, :hibernate}</code></li>
<li><code>{:noreply, reply, new_state}</code></li>
<li><code>{:noreply, reply, new_state, timeout}</code></li>
<li><code>{:noreply, reply, new_state, :hibernate}</code></li>
<li><code>{:stop, reason, reply, new_state}</code></li>
<li><code>{:stop, reason, new_state}</code></li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="aviso-sobre-el-parámetro-from">Aviso sobre el parámetro
<code>from</code></h3>
<ul>
<li><p>En la implementación que hemos realizado anteriormente, el
parámetro <code>from</code> contenía el PID del cliente que realiza la
llamada.</p></li>
<li><p>En el caso de <code>GenServer</code>, este parámetro contiene un
par <code>{pid, ref}</code>, donde <code>pid</code> es el PID del
cliente y <code>ref</code> es un término que identifica únivocamente a
esa llamada.</p></li>
<li><p>El resto de parámetros (<code>request</code> y
<code>state</code>) tienen el mismo significado que en la implementación
refactorizada que hemos realizado anteriormente.</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="valores-de-retorno-de-handle_call">Valores de retorno de
<code>handle_call</code></h3>
<div style="font-size:80%">
<ul>
<li><p><code>{:reply, reply, new_state}</code><br/>
<code>{:reply, reply, new_state, timeout}</code><br/>
<code>{:reply, reply, new_state, :hibernate}</code></p>
<p>Se devolverá la respuesta <code>reply</code> al cliente, y el estado
del servidor pasará a ser <code>new_state</code>.</p></li>
<li><p><code>{:no_reply, new_state}</code><br/>
<code>{:no_reply, new_state, timeout}</code><br/>
<code>{:no_reply, new_state, :hibernate}</code></p>
<p>La función <code>handle_call</code> no devolverá una respuesta al
cliente, porque delegará esa respuesta en otro proceso. El proceso
delegado deberá responder mediante <code>GenServer.reply/2</code>.</p>
<p>El estado del proceso pasa a ser <code>new_state</code>.</p></li>
</ul>
</div>
</section>
<section class="slide level2">

<ul>
<li><p><code>{:stop, reason, reply, new_state}</code></p>
<p>El servidor devolverá la respuesta <code>reply</code> al cliente, y a
partir de ese momento dejará de atender peticiones.</p>
<p>El estado del servidor pasará a ser <code>new_state</code>, que puede
ser de utilidad para la función <em>callback</em>
<code>terminate/2</code>, que se encarga de las (posibles) tareas de
limpieza.</p>
<p>El motivo de la parada del servidor se especifica en la componente
<code>reason</code>.</p></li>
<li><p><code>{:stop, reason, new_state}</code></p>
<p>Igual que el anterior, pero se delega la respuesta al cliente en otro
proceso, que deberá responder mediante
<code>GenServer.reply/2</code>.</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="ejemplos-1">Ejemplos</h3>
<h4 id="servidor-de-áreas-2">Servidor de áreas</h4>
<div class="sourceCode" id="cb31"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:rectangle</span>, width, height<span class="fu">}</span>, _from, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, width <span class="op">*</span> height, state<span class="fu">}</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:circle</span>, radius<span class="fu">}</span>, _from, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="va">:math</span><span class="op">.</span>pi <span class="op">*</span> radius <span class="op">*</span> radius, state<span class="fu">}</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span>other, _from, state<span class="fu">)</span>, <span class="va">do:</span> <span class="fu">{</span><span class="va">:reply</span>, <span class="fu">{</span><span class="va">:error</span>, other<span class="fu">}</span>, state<span class="fu">}</span></span></code></pre></div>

<h4 id="servidor-de-ficheros-2">Servidor de ficheros</h4>
<div class="sourceCode" id="cb32"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:list_dir</span>, _from, dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="cn">File</span><span class="op">.</span>ls<span class="fu">(</span>dir<span class="fu">)</span>, dir<span class="fu">}</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:get_file</span>, file<span class="fu">}</span>, _from, dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  path <span class="op">=</span> <span class="cn">Path</span><span class="op">.</span>join<span class="fu">(</span>dir, file<span class="fu">)</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, <span class="cn">File</span><span class="op">.</span>read<span class="fu">(</span>path<span class="fu">)</span>, dir<span class="fu">}</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

</section>
<section class="slide level2">

<h4 id="servidor-de-tickets-2">Servidor de tickets</h4>
<div class="sourceCode" id="cb33"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:get_ticket</span>, _from, <span class="ot">[]</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:stop</span>, <span class="va">:normal</span>, <span class="va">:error</span>, <span class="ot">[]</span><span class="fu">}</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:get_ticket</span>, _from, <span class="ot">[</span>t<span class="ot">]</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:stop</span>, <span class="va">:normal</span>, t, <span class="ot">[]</span><span class="fu">}</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_call<span class="fu">(</span><span class="va">:get_ticket</span>, _from, <span class="ot">[</span>t <span class="op">|</span> ts<span class="ot">]</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:reply</span>, t, ts<span class="fu">}</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

</section>
<section id="función-callback-handle_cast2" class="slide level2">
<h2>Función <em>callback</em> <code>handle_cast/2</code></h2>
<ul>
<li><p>Se encarga de procesar las peticiones asíncronas.</p></li>
<li><p>Recibe dos parámetros: <code>request</code> y
<code>state</code></p></li>
<li><p>Ha de devolver alguna de las siguientes tuplas:</p>
<ul>
<li><code>{:noreply, reply, new_state}</code></li>
<li><code>{:noreply, reply, new_state, timeout}</code></li>
<li><code>{:noreply, reply, new_state, :hibernate}</code></li>
<li><code>{:stop, reason, new_state}</code></li>
</ul>
<p>Son iguales que las de <code>handle_call</code>, pero omitiendo la
componente <code>reply</code>, ya que el cliente no espera respuesta de
una petición asíncrona.</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="ejemplos-2">Ejemplos</h3>
<h4 id="servidor-de-ficheros-3">Servidor de ficheros</h4>
<div class="sourceCode" id="cb34"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_cast<span class="fu">({</span><span class="va">:change_dir</span>, new_dir<span class="fu">}</span>, _dir<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:noreply</span>, new_dir<span class="fu">}</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

<h4 id="servidor-de-áreas-3">Servidor de áreas</h4>
<p><em>No se define</em></p>
<h4 id="servidor-de-tickets-3">Servidor de tickets</h4>
<p><em>No se define</em></p>
</section>
<section id="función-callback-handle_info2" class="slide level2">
<h2>Función <em>callback</em> <code>handle_info/2</code></h2>
<ul>
<li><p>Se encarga de procesar todos aquellos mensajes recibidos por el
servidor que no han sido generados mediante las funciones
<code>GenServer.call</code> y <code>GenServer.cast</code>. Esto
incluye:</p>
<ul>
<li>Mensajes enviados al servidor utilizando directamente
<code>send</code>.</li>
<li>Mensajes <code>:timeout</code> que el servidor se envía a sí
mismo.</li>
<li>Notificaciones <code>:DOWN</code> provenientes de procesos
monitorizados.</li>
<li>Notificaciones <code>:EXIT</code> provenientes de un proceso
enlazado cuando muere.</li>
</ul></li>
<li><p>Los parámetros y resultados de <code>handle_info</code> tienen la
misma semántica que los de <code>handle_cast</code>.</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="ejemplos-3">Ejemplos</h3>
<ul>
<li><p>En nuestros tres ejemplos (servidor de áreas, ficheros y tickets)
nos limitaremos a imprimir por pantalla el mensaje recibido y
mantendremos el mismo estado:</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> handle_info<span class="fu">(</span>msg, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="cn">IO</span><span class="op">.</span>puts<span class="fu">(</span><span class="st">&quot;Recibido mensaje: </span><span class="ot">#{</span>inspect<span class="fu">(</span>msg<span class="fu">)</span><span class="ot">}</span><span class="st">&quot;</span><span class="fu">)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="va">:noreply</span>, state<span class="fu">}</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
</ul>
</section>
<section id="función-callback-terminate2" class="slide level2">
<h2>Función <em>callback</em> <code>terminate/2</code></h2>
<ul>
<li><p>Es invocada cuando alguna de las funciones
<code>handle_call</code>, <code>handle_cast</code> o
<code>handle_info</code> devuelve una tupla
<code>{:stop, ...}</code>.</p></li>
<li><p>También es invocada si el proceso que inició el servidor mediante
<code>start_link</code> muere.</p>
<ul>
<li>En ese caso, es necesario capturar las señales mediante
<code>Process.flag</code>.</li>
</ul></li>
<li><p>Recibe dos parámetros: <code>reason</code> y
<code>state</code>.</p></li>
<li><p>El valor de retorno es ignorado.</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="ejemplos-4">Ejemplos</h3>
<ul>
<li><p>En nuestros ejemplos (servidor de áreas, ficheros y tickets) nos
limitaremos a imprimir por pantalla un mensaje.</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> terminate<span class="fu">(</span>_reason, _state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="cn">IO</span><span class="op">.</span>puts<span class="fu">(</span><span class="st">&quot;Servidor finalizado&quot;</span><span class="fu">)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</li>
</ul>
</section>
<section id="funciones-del-módulo-genserver" class="slide level2">
<h2>Funciones del módulo <code>GenServer</code></h2>
<p><img data-src="21/GenServer3.svg" style="width:50.0%" /></p>
<ul>
<li><code>GenServer.start</code>, <code>GenServer.start_link</code></li>
<li><code>GenServer.call</code>, <code>GenServer.cast</code></li>
<li><code>GenServer.stop</code></li>
</ul>
</section>
<section id="funciones-start-y-start_link" class="slide level2">
<h2>Funciones <code>start</code> y <code>start_link</code></h2>
<ul>
<li><p>Arrancan un servidor implementado mediante
<code>GenServer</code>.</p></li>
<li><p><code>GenServer.start(Modulo, Arg, Options)</code></p>
<ul>
<li><p><code>Modulo</code>: Nombre del módulo que implementa las
funciones <em>callback</em> del servidor.</p></li>
<li><p><code>Arg</code>: Término pasado como argumento a la función
<em>callback</em> <code>init/1</code>.</p></li>
<li><p><code>Options</code>: <em>Keyword list</em> de opciones
adicionales</p></li>
</ul></li>
<li><p>Devuelve un par <code>{:ok, pid}</code> con el PID del servidor
creado.</p></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>La función <code>start</code>:</p>
<ol type="1">
<li><p>Llama a la función <code>init</code> del <code>Modulo</code>
indicado, pasando <code>Arg</code> como parámetro.</p></li>
<li><p>Lanza (mediante <code>spawn</code>) el servidor, pasándole el
estado inicial devuelto por <code>init</code>.</p></li>
<li><p>Devuelve el PID del proceso iniciado.</p></li>
</ol></li>
<li><p>Existe una variante (<code>start_link</code>) que se comporta
igual que <code>start</code>, pero crea un enlace vital entre el
servidor y el proceso que lo inicia.</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="opciones-de-start-y-start_link">Opciones de <code>start</code> y
<code>start_link</code></h3>
<ul>
<li><p><code>name: N</code></p>
<p>Registra el servidor con el nombre <code>N</code></p></li>
<li><p><code>timeout: T</code></p>
<p>Si tras <code>T</code> milisegundos no se ha inicializado el
servidor, se devuelve <code>{:error, :timeout}</code>.</p></li>
<li><p><code>hibernate: T</code></p>
<p>Transcurridos <code>T</code> milisegundos tras la inicialización, si
no se ha recibido ningún mensaje, el servidor pasa a estado de
hibernación.</p></li>
</ul>
</section>
<section id="función-call" class="slide level2">
<h2>Función <code>call</code></h2>
<ul>
<li><p>Realiza peticiones síncronas al servidor:</p></li>
<li><p><code>GenServer.call(server, request, timeout \\ 5000)</code></p>
<ul>
<li><code>server</code>: PID o nombre del proceso servidor</li>
<li><code>request</code>: petición a enviar</li>
<li><code>timeout</code>: tiempo máximo de espera (en ms) para recibir
una respuesta (puede ser <code>:infinity</code>). Si no se recibe en ese
tiempo, <code>call</code> lanza una excepción.</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>Cuando se hace uso de <code>call</code>:</p>
<ol type="1">
<li><p>La función <code>call</code> envía el mensaje
<code>request</code> al servidor indicado.</p></li>
<li><p>El servidor llama a la función <code>handle_call</code> pasando
la <code>request</code> correspondiente.</p></li>
<li><p>La función <code>handle_call</code> devuelve una respuesta y el
estado actualizado.</p></li>
<li><p>El servidor envía la respuesta de <code>handle_call</code> al
proceso que ha llamado a <code>call</code> y actualiza su
estado.</p></li>
<li><p>La función <code>call</code> recibe el mensaje enviado por el
servidor, y devuelve la respuesta contenida en dicho mensaje.</p></li>
</ol></li>
</ul>
</section>
<section id="función-cast" class="slide level2">
<h2>Función <code>cast</code></h2>
<ul>
<li><p>Realiza peticiones asíncronas al servidor:</p></li>
<li><p><code>GenServer.cast(server, request)</code></p>
<ul>
<li><code>server</code>: PID o nombre del proceso servidor</li>
<li><code>request</code>: petición a enviar</li>
</ul></li>
<li><p>La función <code>cast</code> devuelve <code>:ok</code> tras
enviar la petición al servidor.</p></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>Cuando se hace uso de <code>cast</code>:</p>
<ol type="1">
<li><p>La función <code>cast</code> envía el mensaje
<code>request</code> al servidor indicado y devuelve <code>:ok</code> al
llamante.</p></li>
<li><p>El servidor llama a la función <code>handle_cast</code> pasando
la <code>request</code> correspondiente.</p></li>
<li><p>La función <code>handle_cast</code> devuelve el estado
actualizado.</p></li>
<li><p>El servidor actualiza su estado.</p></li>
</ol></li>
</ul>
</section>
<section id="función-stop" class="slide level2">
<h2>Función <code>stop</code></h2>
<ul>
<li><p>Finaliza un <code>GenServer</code></p>
<p><code>GenServer.stop(server, reason, timeout)</code></p></li>
<li><p>La parada se realiza de manera síncrona. Es decir, el proceso que
llama a <code>stop</code> espera a que el servidor finalice.</p></li>
<li><p>El servidor llamará a la función <em>callback</em>
<code>terminate</code> antes de finalizar.</p></li>
<li><p>Cualquier valor de <code>reason</code> distinto de
<code>:normal</code> o <code>:shutdown</code> se considera muerte por
causa anormal, y generará un mensaje de error.</p></li>
</ul>
</section>
<section id="código-final-servidor-de-áreas" class="slide level2">
<h2>Código final: servidor de áreas</h2>
<div class="sourceCode" id="cb37" style="font-size:65%"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">AreaServer</span> <span class="kw">do</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="im">use</span> <span class="cn">GenServer</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">########################################</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Funciones callback de GenServer</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">########################################</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@impl</span> <span class="cn">true</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> init<span class="fu">(</span>_<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="va">:ok</span>, <span class="ot">[]</span><span class="fu">}</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@impl</span> <span class="cn">true</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:rectangle</span>, width, height<span class="fu">}</span>, _from, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="va">:reply</span>, width <span class="op">*</span> height, state<span class="fu">}</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> handle_call<span class="fu">({</span><span class="va">:circle</span>, radius<span class="fu">}</span>, _from, state<span class="fu">)</span>, <span class="va">do:</span> <span class="op">...</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> handle_call<span class="fu">(</span>other, _from, state<span class="fu">)</span>, <span class="va">do:</span> <span class="op">...</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@impl</span> <span class="cn">true</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> handle_info<span class="fu">(</span>msg, state<span class="fu">)</span>, <span class="va">do:</span> <span class="op">...</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@impl</span> <span class="cn">true</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> terminate<span class="fu">(</span>_reason, _state<span class="fu">)</span>, <span class="va">do:</span> <span class="op">...</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">### ... continúa ...</span></span></code></pre></div>

</section>
<section class="slide level2">

<div class="sourceCode" id="cb38" style="font-size:75%"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ...continuación...</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">########################################</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Funciones de interfaz</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">########################################</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> start<span class="fu">()</span>, <span class="va">do:</span> <span class="cn">GenServer</span><span class="op">.</span>start<span class="fu">(</span><span class="cn">AreaServer</span>, <span class="cn">false</span><span class="fu">)</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> area_rectangle<span class="fu">(</span>pid_server, width, height<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="cn">GenServer</span><span class="op">.</span>call<span class="fu">(</span>pid_server, <span class="fu">{</span><span class="va">:rectangle</span>, width, height<span class="fu">})</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> area_circle<span class="fu">(</span>pid_server, radius<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="cn">GenServer</span><span class="op">.</span>call<span class="fu">(</span>pid_server, <span class="fu">{</span><span class="va">:circle</span>, radius<span class="fu">})</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

</section>
<section class="slide level2">

<h3 id="use-genserver">¿<code>use GenServer</code>?</h3>
<ul>
<li><p>Indica que el módulo <code>AreaServer</code> implementa funciones
<em>callback</em> de <code>GenServer</code>.</p></li>
<li><p>La directiva <code>use GenServer</code> inyecta definiciones por
defecto para las funciones <em>callback</em> que no hayamos definido
nosotros.</p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="impl-true">¿<code>@impl true</code>?</h3>
<ul>
<li><p>Indica que la función que se define a continuación es una función
<em>callback</em> correspondiente a <code>GenServer</code>.</p></li>
<li><p>Resulta útil para detectar errores si nos equivocamos en el
nombre de la función <code>callback</code>. Por ejemplo:</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ot">@impl</span> <span class="cn">true</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="hl">hanlde_cast</span><span class="fu">(</span>request, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">###...</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>

<p>Como la función <code>hanlde_cast</code> no es ninguna función
<em>callback</em> de <code>GenServer</code>, se muestra un mensaje de
aviso.</p></li>
</ul>
</section></section>
    </div>
  </div>

  <script src="dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="plugin/notes/notes.js"></script>
  <script src="plugin/search/search.js"></script>
  <script src="plugin/zoom/zoom.js"></script>
  <script src="plugin/highlight/highlight.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Prints all fragments in their visible states on the same slide 
        pdfSeparateFragments: false,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // reveal.js plugins
        plugins: [
          RevealNotes,
          RevealSearch,
          RevealZoom,
          // RevealHighlight          
        ]
      });
    </script>
    </body>
</html>
